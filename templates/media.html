<!DOCTYPE html>
<html>
<head>
    <script src="{{ url_for('static', filename='helper.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"></link>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script type="text/javascript">
        var idx = "{{ idx }}"
        var dbId = "{{ db_id }}"
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('connect', function () {
            console.log('Connected to the server');
        });

        socket.on('response', function (data) {
            console.log('Server says: ' + data);
        });

        socket.on('set_asset_' + dbId + '_attribute', function (data) {
            console.log('Server says: ' + data);
            document.getElementById(data['attribute']).checked = data['value'];
        });

        function handleSetAssetBoolean(checkbox, attribute) {
            socket.emit('set_asset_boolean', { db_id: dbId, attribute, value: checkbox.checked });
        }

        function handleTagClicked(checkbox, isMultiselect) {
            socket.emit('set_tag', {
                db_id: dbId,
                tag_id: checkbox.id,
                value: checkbox.checked,
                tag_group_id: checkbox.name,
                is_multiselect: isMultiselect
            });
        }
    </script>
    {% if idx > 0 %}
    <script>
      window.previous_media = "{{ url_for('show_media', idx=idx-1) }}";
    </script>
    {% endif %}
    {% if idx + 1 < total %}
    <script>
      window.next_media = "{{ url_for('show_media', idx=idx+1) }}";
    </script>
    {% endif %}
</head>
<body>
    <h2>{{ filename }} ({{ filesize }} MB)</h2>
    <div class="box">
        <div>
            {% if media_type == 'mp4' %}
            <video width="854" height="480" controls autoplay> 
                <source src="{{ url_for('send_media', idx=idx) }}" type="video/mp4" /> 
            </video>
            {% elif media_type == 'mp3' or media_type == 'ogg' %}
            <audio controls autoplay src="{{ url_for('send_media', idx=idx) }}"></audio>
            {% elif media_type == 'jpg' %}
            <img src="{{ url_for('send_media', idx=idx) }}" /> 
            {% endif %}
            <br/>
            {% if idx > 0 %}
                <a href="{{ url_for('show_media', idx=idx-1) }}">Prev</a>
            {% endif %}
            {% if idx + 1 < total %}
                <a href="{{ url_for('show_media', idx=idx+1) }}">Next</a>
            {% endif %}
            &nbsp;&nbsp;<a href="{{ url_for('show_media', idx='random') }}">Random</a>
            <p/>
            <a href="{{ url_for('list_media') }}#{{ idx }}">Back to list</a>
        </div>
        <div>
            <!--
            <form action="{{ url_for('handle_save') }}" method="POST">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
                <br>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
                <br>
                <input type="submit" value="Submit">
            </form>
            -->
            <div>
                <label>
                    <input type="checkbox" id="favorite"
                    {% if favorite %} checked {% endif %}
                    onclick="handleSetAssetBoolean(this, 'favorite')">Favorite</input>
                </label>
                <br/>
                <label>
                    <input type="checkbox" id="bookmark"
                    {% if bookmark %} checked {% endif %}
                    onclick="handleSetAssetBoolean(this, 'bookmark')">Bookmark</input>
                </label>
                <br/>
                <label>
                    <input type="checkbox" id="should_delete"
                    {% if should_delete %} checked {% endif %}
                    onclick="handleSetAssetBoolean(this, 'should_delete')">Should delete</input>
                </label>
            </div>
            <p/>
            <div>
            {% for tg in tag_groups %}
                <fieldset>
                    <legend><b>{{ tg.name }}</b></legend>
                    <div class="scroll-box scroll-box-{{ tg.show_size }}">
                    {% for tag in tg.tags %}
                        {% if not tg.multiselect or tg.show_size <= 0 %}<div>{% endif %}
                        <label for="{{ tag.id }}" class="inline-label">
                        {% if tg.multiselect %}
                            <input type="checkbox" id="{{ tag.id }}" name="{{ tg.id }}"
                            onclick="handleTagClicked(this, true)" />
                        {% else %}
                            <input type="radio" id="{{ tag.id }}" name="{{ tg.id }}" value="{{ tag.id }}"
                            onclick="handleTagClicked(this, false)" />
                        {% endif %}
                            {{ tag.name }}
                        </label>
                        {% if not tg.multiselect or tg.show_size <= 0 %}</div>{% endif %}
                    {% endfor %}
                    </div>
                </fieldset>
            {% endfor %}
            </div>
        </div>
    </div>
</body>
</html>
